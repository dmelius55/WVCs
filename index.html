<script>
    function getStatus(score) {
        if (score <= 3.5) return { status: 'CRITICAL', class: 'critical', label: 'Highest Priority' };
        if (score <= 4.5) return { status: 'HIGH', class: 'high', label: 'High Priority' };
        if (score <= 5.5) return { status: 'MEDIUM', class: 'medium', label: 'Medium Priority' };
        return { status: 'LOW', class: 'low', label: 'Lower Priority' };
    }

    const data = [
        { location: "Berlin N", rate: 3.9, detections: 97, species: "Moose", infrastructure: "Full AOP", geo: "Mostly comp.", total_score: 3.8 },
        { location: "Berlin S", rate: 1.3, detections: 41, species: "Moose", infrastructure: "None", geo: "Partly comp.", total_score: 4.4 },
        { location: "Lebanon", rate: 18.6, detections: 39, species: "Gray fox", infrastructure: "None", geo: "Mostly comp.", total_score: 5.9 },
        { location: "Newbury", rate: 20.7, detections: 112, species: "Gray fox", infrastructure: "None", geo: "Mostly comp.", total_score: 5.5 },
        { location: "Concord", rate: 3.5, detections: 3, species: "Gray fox", infrastructure: "Reduced AOP", geo: "Partly comp.", total_score: 2.3 },
        { location: "Epsom S", rate: 15.1, detections: 75, species: "Gray fox", infrastructure: "Adult AOP", geo: "Mostly incomp.", total_score: 5.3 },
        { location: "Epsom N", rate: 13.5, detections: 56, species: "Gray fox", infrastructure: "None", geo: "Mostly incomp.", total_score: 5.3 },
        { location: "Epping", rate: 12.9, detections: 29, species: "Gray fox", infrastructure: "Reduced AOP", geo: "Mostly incomp.", total_score: 4.7 },
        { location: "Stratham", rate: 14.2, detections: 82, species: "Gray fox", infrastructure: "Reduced AOP", geo: "NA", total_score: 5.3 },
        { location: "Lee", rate: 4.4, detections: 44, species: "Gray fox", infrastructure: "Full AOP", geo: "Partly comp.", total_score: 3.1 },
        { location: "Barrington", rate: 21.7, detections: 107, species: "Gray fox", infrastructure: "Adult AOP", geo: "Mostly comp.", total_score: 5.4 },
        { location: "Alton", rate: 3.3, detections: 34, species: "N/A", infrastructure: "Reduced AOP", geo: "Partly comp.", total_score: 3.3 },
        { location: "Ossipee", rate: 1.3, detections: 24, species: "Gray fox", infrastructure: "Full AOP", geo: "Partly comp.", total_score: 5.1 }
    ];

    const container = document.querySelector('.grid');

    function renderCards(filterStatus = "ALL") {
        container.innerHTML = "";

        data.forEach(item => {
            const statusInfo = getStatus(item.total_score);

            if (filterStatus !== "ALL" && statusInfo.status !== filterStatus) {
                return; // skip this card
            }

            const cardHtml = `
                <div class="card ${statusInfo.class} border-${statusInfo.class} bg-${statusInfo.class} p-5 rounded-lg">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-xl font-bold text-gray-800">${item.location}</h3>
                        <span class="badge badge-${statusInfo.class} text-white uppercase">${statusInfo.status}</span>
                    </div>
                    <div class="space-y-1 text-sm text-gray-700">
                        <div class="data-row bg-white/70 rounded px-2">
                            <strong class="text-base text-gray-800">Total Score Index</strong>
                            <span class="data-value text-xl font-extrabold">${item.total_score.toFixed(1)}</span>
                        </div>
                        <div class="data-row"><strong>WVC Rate*</strong><span class="data-value">${item.rate.toFixed(1)}</span></div>
                        <div class="data-row"><strong>Roadside Detections</strong><span class="data-value">${item.detections}</span></div>
                        <div class="data-row"><strong>Species of Concern</strong><span class="data-value">${item.species}</span></div>
                        <div class="data-row"><strong>Geo Compatibility</strong><span class="data-value">${item.geo}</span></div>
                        <div class="mt-4 pt-2 border-t border-gray-200">
                            <p class="text-xs text-gray-500 italic">Infrastructure: ${item.infrastructure}</p>
                        </div>
                    </div>
                </div>
            `;

            container.innerHTML += cardHtml;
        });
    }

    // Render default
    renderCards();

    // Dropdown listener
    document.getElementById('statusFilter').addEventListener('change', e => {
        renderCards(e.target.value);
    });
</script>
